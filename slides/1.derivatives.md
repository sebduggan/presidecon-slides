## Derivatives

- Programmatically defined rules to transform assets
- Default derivatives in Preside, e.g. `adminThumbnail`, `pickerIcon`
- Can be chained, for example to create a PDF page image before resizing

---

## Transformation: shrinkToFit

- Requires `width` and `height` arguments
- Optionally specify `quality` (defaults to "highPerformance")
- Will resize the image to be contained within the dimensions
- Maintains the image's aspect ratio

---

## Transformation: shrinkToFit

pageThumbnail is one of Preside's built-in derivatives, and shrinks the image to fit within a 100x100 box:

```actionscript
settings.assetManager.derivatives.pageThumbnail = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "shrinkToFit"
			, args   = { width=100, height=100 }
		}
	  ]
};
```

---

## Transformation: shrinkToFit

<img src="img/country-lane.jpg" height="400">

---

## Transformation: shrinkToFit

<img src="img/country-lane.jpg" width="100" style="padding:20px 0;background: none;">

---

## Transformation: resize

- Takes `width` and/or `height` arguments
- Optionally specify `quality` (defaults to "highPerformance")
- Optionally specify `maintainAspectRatio` (defaults to false)

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.width300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = { width=300 }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly.jpg" width="300">

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.square300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = { width=300, height=300 }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly.jpg" width="300" height="300">

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.square300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = {
				  width               = 300
				, height              = 300
				, maintainAspectRatio = true
			  }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly-square.jpg">

---

## Rendering images

Method 1: use `event.buildLink()`

```actionscript
imageUrl = event.buildLink(
	  assetId    = "..."
	, derivative = "bannerImage"
);
```

- returns the URL of the image
- omitting `derivative` will return the original image

---

## Rendering images

Method 2: use `renderAsset()`

```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, args    = { derivative="bannerImage" }
);
```

---

## Rendering images

Method 2: use `renderAsset()`

```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, args    = {
		  derivative = "bannerImage"
		, class      = "customClass"
		, label      = "Image description"
	  }
);
```

- returns the complete `<img>` tag

---

## Custom image renderer

- By default, `renderAsset()` will use the default renderer for the file type, e.g. `renderers.asset.image.default`
- Renderer can be just a view, or can have a handler
- Renderer can be targeted at specific filetypes, e.g. `renderers.asset.jpg.default`
- Specify a context to use a custom renderer
```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, context = "banner"
);
```

---

## Custom image renderer

If context is "banner", a JPEG image asset would be rendered using the first of these that is available:
- renderers.asset.jpg.banner
- renderers.asset.image.banner
- renderers.asset.jpg.default
- renderers.asset.image.default
- renderers.asset.default

---

## Custom image renderer

`/application/views/renderers/
asset/image/banner.cfm`
```html
<cfscript>
    id       = args.id    ?: "";
    label    = args.label ?: "";
    imageUrl = event.buildLink(
    	  assetId    = id
    	, derivative = "bannerImage"
    );
</cfscript>
<cfoutput>
    <div class="banner-image">
        <img src="#imageUrl#" alt="#label#" title="#label#" />
    </div>
</cfoutput>
```

---

## Image resize drawbacks

Take this image as an example:

<img src="img/puffin-1.jpg">

---

## Image resize drawbacks

Resized using our 300x300 derivative:

<img src="img/puffin-1-crop.jpg">

---

## Image resize drawbacks

How about a 650x200 banner derivative?

<img src="img/puffin-1-banner-crop.jpg">

---

## Image resize drawbacks

Previous options for dealing with this:

1. Live with the bad cropping
2. Upload an extra asset to the page â€” the same source image, but pre-cropped externally
	- Places extra burden on the user
	- Makes our page object untidy

There is now a simple solution...

---

## Focal Points

Introduced in Preside 10.9

<img src="img/focal-point.png">

---

## Focal Points

Introduced in Preside 10.9

<img src="img/focal-point-selected.png">

---

## Focal Points

Now our square crop will produce this:

<img src="img/puffin-1-focal-point-crop.jpg">

---

## Focal Points

...and our banner derivative:

<img src="img/puffin-1-banner-focal-point-crop.jpg">