## Working with images in Preside

- Derivatives and transformations
- Rendering images in Preside
- Current limitations of derivatives
- New features in Preside 10.9
- Responsive images
- Demonstration in Preside

---

## Derivatives

- Programmatically defined rules to transform assets
- Preside has a number of built-in derivatives
	- `adminThumbnail`
	- `pickerIcon`
- Can be chained, for example to create a PDF page image before resizing

---

## Transformation: shrinkToFit

- Requires `width` and `height` arguments
- Optionally specify `quality` (defaults to "highPerformance")
- Will resize the image to be contained within the dimensions
- Maintains the image's aspect ratio

---

## Transformation: shrinkToFit

pageThumbnail is one of Preside's built-in derivatives, and shrinks the image to fit within a 100x100 box:

```actionscript
settings.assetManager.derivatives.pageThumbnail = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "shrinkToFit"
			, args   = { width=100, height=100 }
		}
	  ]
};
```

---

## Transformation: shrinkToFit

<img src="img/country-lane.jpg" height="400">

---

## Transformation: shrinkToFit

<img src="img/country-lane.jpg" width="100" style="padding:20px 0;background: none;">

---

## Transformation: resize

- Takes `width` and/or `height` arguments
- Optionally specify `quality` (defaults to "highPerformance")
- Optionally specify `maintainAspectRatio` (defaults to false)

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.width300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = { width=300 }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly.jpg" width="300">

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.square300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = { width=300, height=300 }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly.jpg" width="300" height="300">

---

## Transformation: resize

```actionscript
settings.assetManager.derivatives.square300 = {
	  permissions     = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = {
				  width               = 300
				, height              = 300
				, maintainAspectRatio = true
			  }
		}
	  ]
};
```

---

## Transformation: resize

<img src="img/dragonfly.jpg">

---

## Transformation: resize

<img src="img/dragonfly-square.jpg">

---

## Rendering images

Method 1: use `event.buildLink()`

```actionscript
imageUrl = event.buildLink(
	  assetId    = "..."
	, derivative = "bannerImage"
);
```

- returns the URL of the image
- omitting `derivative` will return the original image

---

## Rendering images

Method 2: use `renderAsset()`

```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, args    = { derivative="bannerImage" }
);
```

---

## Rendering images

Method 2: use `renderAsset()`

```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, args    = {
		  derivative = "bannerImage"
		, class      = "customClass"
		, label      = "Image description"
	  }
);
```

- default renderer returns the complete `<img>` tag

---

## Custom image renderer

- By default, `renderAsset()` will use the default renderer for the file type, e.g. `renderers.asset.image.default`
- Renderer can be just a view, or can have a handler
- Renderer can be targeted at specific filetypes, e.g. `renderers.asset.jpg.default`
- Specify a context to use a custom renderer
```actionscript
renderedImage = renderAsset(
	  assetId = "..."
	, context = "banner"
);
```

---

## Custom image renderer

If context is "banner", a JPEG image asset would be rendered using the first of these that is available:
- renderers.asset.jpg.banner
- renderers.asset.image.banner
- renderers.asset.jpg.default
- renderers.asset.image.default
- renderers.asset.default

---

## Custom image renderer

`/application/views/renderers/
asset/image/banner.cfm`
```html
<cfscript>
    id       = args.id    ?: "";
    label    = args.label ?: "";
    imageUrl = event.buildLink(
    	  assetId    = id
    	, derivative = "bannerImage"
    );
</cfscript>
<cfoutput>
    <div class="banner-image">
        <img src="#imageUrl#" alt="#label#" title="#label#" />
    </div>
</cfoutput>
```

---

## Image resize drawbacks (1)

Take this image as an example:

<img src="img/puffin-1.jpg">

---

## Image resize drawbacks (1)

Resized using our 300x300 derivative:

<img src="img/puffin-1-crop.jpg">

---

## Image resize drawbacks (1)

How about a 650x200 banner derivative?

<img src="img/puffin-1-banner-crop.jpg">

---

## Image resize drawbacks (1)

Previous options for dealing with this:

1. Live with the bad cropping
2. Upload an extra asset to the page â€” the same source image, but pre-cropped externally
	- Places extra burden on the user
	- Makes our page object untidy

---

## Focal Points

Introduced in Preside 10.9

<img src="img/focal-point.png" height="350">

---

## Focal Points

Introduced in Preside 10.9

<img src="img/focal-point-selected.png" height="350">

---

## Focal Points

Now our square crop will produce this:

<img src="img/puffin-1-focal-point-crop.jpg">

---

## Focal Points

...and our banner derivative:

<img src="img/puffin-1-banner-focal-point-crop.jpg">

---

## Image resize drawbacks (2)

Here is another example image:

<img src="img/puffin-2.jpg" height="400">

---

## Image resize drawbacks (2)

Resized as a 100x100 thumbnail:

<img src="img/puffin-2-crop.jpg" height="100">

---

## Crop Hints

Introduced in Preside 10.9

<img src="img/crop-hint.png" height="350">

---

## Crop Hints

Introduced in Preside 10.9

<img src="img/crop-hint-selected.png" height="350">

---

## Crop Hints

Simply tell your derivative to use crop hints:

```
settings.assetManager.derivatives.croppedThumbnail = {
	  permissions = "inherit"
	, transformations = [
		{
			  method = "resize"
			, args   = {
				  width       = 100
				, height      = 100
				, useCropHint = true
			  }
		}
	]
};
```

---

## Crop Hints

Now our thumbnail will look like this:

<img src="img/puffin-2-crop-hint-crop.jpg" height="100">

---

## Crop Hints

Crop hints are also useful for cropping portraits:

<img src="img/businessman.jpg" height="350">

---

## Crop Hints

Crop hints are also useful for cropping portraits:

<img src="img/businessman-crop.jpg" height="200">

---

## Crop Hints

Crop hints are also useful for cropping portraits:

<img src="img/businessman-crop.jpg" height="200" style="border-radius:50%;">

```css
img.avatar {
	border-radius : 50%;
}
```

---

## Responsive Images

- Two different use cases
	- Different resolutions of the same image
	- Art direction: variations on an image
- Two methods of implementation
	- `<img srcset="...">`
	- `<picture>`
- Only load the preferred image version
- Excellent support by modern browsers
- Degrades gracefully

---

## srcset

```
<img src="small.jpg"
	srcset="medium.jpg 1000w, large 2000w"
	sizes="(max-width: 480px) 100vw, 50vw"
	alt="...">
```

- Simplest method
- Ideal for alternate resolutions (e.g. Retina)
- Browser does the hard work
- `sizes` is optional; assumes image is 100% wide
- Falls back to `src` image if not supported

---

## srcset

<img src="img/caniuse-srcset.png" width="750">

---

## picture

```
<picture>
	<source srcset="large.jpg"  media="(min-width: 901px)">
	<source srcset="medium.jpg" media="(min-width: 600px)">
	<source srcset="small.jpg">
	<img src="medium.jpg" alt="...">
</picture>
```

- More complex, but more controllable
- Best for art direction
- `srcset` can include multiple resolutions
- Falls back to `<img>` content if not supported

---

## picture

<img src="img/caniuse-picture.png" width="750">

---

## Some examples in Preside